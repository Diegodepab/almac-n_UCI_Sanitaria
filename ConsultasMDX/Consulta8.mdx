

-- Consulta: 8
--  Análisis de Medicación y Parámetros Respiratorios Excluyendo Pacientes de Etnia Hispánica
WITH 
    -- Miembros calculados para la media de PaO2 y FiO2
    MEMBER [Measures].[MediaPaO2] AS
        [Measures].[Pa O2] / [Measures].[Measures].[Recuento Ingreso UCI],
        FORMAT_STRING = "##.00"
        
    MEMBER [Measures].[MediaFiO2] AS
        [Measures].[Fi O2] / [Measures].[Measures].[Recuento Ingreso UCI],
        FORMAT_STRING = "##.00"

SELECT 
    -- En las columnas se muestran las medidas Recuento Ingreso UCI, MediaPaO2 y MediaFiO2
    { 
        [Measures].[Recuento UCI Medicacion],
        [Measures].[MediaPaO2],
        [Measures].[MediaFiO2]
    } ON COLUMNS,
    
    -- En las filas se muestran la Ruta de Administración de Medicamentos y el Año de Alta Hospitalaria
    NON EMPTY 
    CROSSJOIN(
        [Medication].[RoutaMed].[Route Admin ID].MEMBERS, -- Ruta de Administración de Medicamentos (Arterial, Hemodialysis, I-UTERAL)
        [Tiempo].[Tiempo].[Hospital Discharge Year].MEMBERS -- Año de Alta Hospitalaria (2015, 2014, etc.)
    ) ON ROWS
FROM 
    [PruebaDefinitiva]

WHERE 
    -- Todas las etnias menos la hispánica
    EXCEPT(
        [Paciente].[Etnia].[Ethnicity ID].MEMBERS,
        {[Paciente].[Etnia].[Ethnicity ID].[Hispanic]}
    )
